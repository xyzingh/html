<!DOCTYPE html><html class=split lang=en-US-x-hixie><script src=/html/link-fixup.js defer=""></script><meta charset=utf-8><meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name=viewport><title>HTML Standard</title><meta content=#3c790a name=theme-color><link rel=stylesheet href=https://resources.whatwg.org/spec.css><link rel=stylesheet href=https://resources.whatwg.org/standard.css><link rel=stylesheet href=/html/resources/zh-cn.css><link href=https://resources.whatwg.org/logo.svg rel=icon><script>
   function toggleStatus(div) {
     div.parentNode.classList.toggle('wrapped');
   }
  </script><style>
   .status { min-height: 0.6em; font: 1em sans-serif; width: 9em; padding: 0.3em; position: absolute; z-index: 8; right: 0.3em; background: #EEE; color: black; box-shadow: 0 0 3px #999; overflow: hidden; margin: -2em 0 0 0; border-collapse: initial; border-spacing: initial; }
   .status:hover { z-index: 9; }
   .status:focus-within { z-index: 9; }
   .status.wrapped > :not(input) { display: none; }
   .status > input { position: absolute; left: 0; top: 0; width: 1em; height: 1em; border: none; background: transparent; padding: 0; margin: 0; }
   .status > p { font-size: 0.6em; margin: 0; padding: 0; }
   .status > p + p { padding-top: 0.5em; }
   .status > p > strong { margin-left: 1.5em; }
   .status > .support { display: block; }
   .status > .support > span { padding: 0.2em 0; display: block; display: table; }
   .status > .support > span.partial { color: #666666; filter: grayscale(50%); }
   .status > .support > span.no { color: #CCCCCC; filter: grayscale(100%); }
   .status > .support > span.no::before { opacity: 0.5; }
   .status > .support > span:first-of-type { padding-top: 0.5em; }
   .status > .support > span > span { padding: 0 0.5em; display: table-cell; vertical-align: top; }
   .status > .support > span > span:first-child { width: 100%; }
   .status > .support > span > span:last-child { width: 100%; white-space: pre; padding: 0; }
   .status > .support > span::before { content: ' '; display: table-cell; min-width: 1.5em; height: 1.5em; background: no-repeat center center; background-size: contain; text-align: right; font-size: 0.75em; font-weight: bold; }
   .status > .support > .and_chr::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
   .status > .support > .and_ff::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .and_uc::before { background-image: url(https://resources.whatwg.org/browser-logos/uc.png); } /* UC Browser for Android */
   .status > .support > .android::before { background-image: url(https://resources.whatwg.org/browser-logos/android.svg); }
   .status > .support > .bb::before { background-image: url(https://resources.whatwg.org/browser-logos/bb.jpg); } /* Blackberry Browser */
   .status > .support > .chrome::before { background-image: url(https://resources.whatwg.org/browser-logos/chrome.svg); }
   .status > .support > .edge::before { background-image: url(https://resources.whatwg.org/browser-logos/edge.svg); }
   .status > .support > .firefox::before { background-image: url(https://resources.whatwg.org/browser-logos/firefox.png); }
   .status > .support > .ie::before { background-image: url(https://resources.whatwg.org/browser-logos/ie.png); }
   .status > .support > .ie_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/ie-mobile.svg); }
   .status > .support > .ios_saf::before { background-image: url(https://resources.whatwg.org/browser-logos/safari-ios.svg); }
   .status > .support > .op_mini::before { background-image: url(https://resources.whatwg.org/browser-logos/opera-mini.png); }
   .status > .support > .op_mob::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .opera::before { background-image: url(https://resources.whatwg.org/browser-logos/opera.png); }
   .status > .support > .safari::before { background-image: url(https://resources.whatwg.org/browser-logos/safari.png); }
   .status > .support > .samsung::before { background-image: url(https://resources.whatwg.org/browser-logos/samsung.png); }
   .status > .caniuse { text-align: right; font-style: italic; width: 100%; }
   .status > .caniuse + p { margin-top: 0.5em; border-top: 1px solid silver; }

   @media (max-width: 767px) {
     .status { right: -9em; }
   }
  </style><style>
   [hidden] { display: none; }

   .bad, .bad *:not(.X\58X) { color: gray; border-color: gray; background: transparent; }

   .fingerprint { position: absolute; right: 0; z-index: 5; }
   @media (max-width: 767px) {
     .fingerprint { max-width: 35px; }
   }

   .applies .yes, .yesno .yes { background: yellow; }
   .yesno .yes, .yesno .no { text-align: center; }

   .applies thead th > * { display: block; }
   .applies thead code { display: block; }
   .applies td { text-align: center; }

   .matrix, .matrix td { border: hidden; text-align: right; }
   .matrix { margin-left: 2em; }

   .vertical-summary-table tr > th[rowspan="2"]:first-child + th,
   .vertical-summary-table tr > td[rowspan="2"]:first-child + td { border-bottom: hidden; }

   .dice-example { border-collapse: collapse; border-style: hidden solid solid hidden; border-width: thin; margin-left: 3em; }
   .dice-example caption { width: 30em; font-size: smaller; font-style: italic; padding: 0.75em 0; text-align: left; }
   .dice-example td, .dice-example th { border: solid thin; width: 1.35em; height: 1.05em; text-align: center; padding: 0; }

   td.eg { border-width: thin; text-align: center; }

   #table-example-1 { border: solid thin; border-collapse: collapse; margin-left: 3em; }
   #table-example-1 caption { padding-bottom: 0.5em; }
   #table-example-1 thead, #table-example-1 tbody { border: none; }
   #table-example-1 th, #table-example-1 td { border: solid thin; }
   #table-example-1 th { font-weight: normal; }
   #table-example-1 td { border-style: none solid; vertical-align: top; }
   #table-example-1 th { padding: 0.5em; vertical-align: middle; text-align: center; }
   #table-example-1 tbody tr:first-child td { padding-top: 0.5em; }
   #table-example-1 tbody tr:last-child td { padding-bottom: 1.5em; }
   #table-example-1 tbody td:first-child { padding-left: 2.5em; padding-right: 0; width: 9em; }
   #table-example-1 tbody td:first-child::after { content: leader(". "); }
   #table-example-1 tbody td { padding-left: 2em; padding-right: 2em; }
   #table-example-1 tbody td:first-child + td { width: 10em; }
   #table-example-1 tbody td:first-child + td ~ td { width: 2.5em; }
   #table-example-1 tbody td:first-child + td + td + td ~ td { width: 1.25em; }

   .apple-table-examples { border: none; border-collapse: separate; border-spacing: 1.5em 0em; width: 40em; margin-left: 3em; }
   .apple-table-examples * { font-family: "Times", serif; }
   .apple-table-examples td, .apple-table-examples th { border: none; white-space: nowrap; padding-top: 0; padding-bottom: 0; }
   .apple-table-examples tbody th:first-child { border-left: none; width: 100%; }
   .apple-table-examples thead th:first-child ~ th { font-size: smaller; font-weight: bolder; border-bottom: solid 2px; text-align: center; }
   .apple-table-examples tbody th::after, .apple-table-examples tfoot th::after { content: leader(". ") }
   .apple-table-examples tbody th, .apple-table-examples tfoot th { font: inherit; text-align: left; }
   .apple-table-examples td { text-align: right; vertical-align: top; }
   .apple-table-examples.e1 tbody tr:last-child td { border-bottom: solid 1px; }
   .apple-table-examples.e1 tbody + tbody tr:last-child td { border-bottom: double 3px; }
   .apple-table-examples.e2 th[scope=row] { padding-left: 1em; }
   .apple-table-examples sup { line-height: 0; }

   .three-column-nowrap tr > td:first-child,
   .three-column-nowrap tr > td:first-child + td,
   .three-column-nowrap tr > td:first-child + td + td { white-space: nowrap; }

   .details-example img { vertical-align: top; }

   .parse-error-table td > p:first-child { margin-top: 0; }

   #named-character-references-table {
     white-space: nowrap;
     font-size: 0.6em;
     column-width: 30em;
     column-gap: 1em;
     -moz-column-width: 30em;
     -moz-column-gap: 1em;
     -webkit-column-width: 30em;
     -webkit-column-gap: 1em;
   }
   #named-character-references-table > table > tbody > tr > td:first-child + td,
   #named-character-references-table > table > tbody > tr > td:last-child { text-align: center; }
   #named-character-references-table > table > tbody > tr > td:last-child:hover > span { position: absolute; top: auto; left: auto; margin-left: 0.5em; line-height: 1.2; font-size: 5em; border: outset; padding: 0.25em 0.5em; background: white; width: 1.25em; height: auto; text-align: center; }
   #named-character-references-table > table > tbody > tr#entity-CounterClockwiseContourIntegral > td:first-child { font-size: 0.5em; }

   .glyph.control { color: red; }

   #table-example-1 * { font-family: "Essays1743", serif; line-height: 1.01em; }
   @font-face {
     font-family: 'Essays1743';
     src: url('/html/fonts/Essays1743.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-weight: bold;
     src: url('/html/fonts/Essays1743-Bold.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     src: url('/html/fonts/Essays1743-Italic.ttf');
   }
   @font-face {
     font-family: 'Essays1743';
     font-style: italic;
     font-weight: bold;
     src: url('/html/fonts/Essays1743-BoldItalic.ttf');
   }

   @media (max-width: 767px) {
     #abstractimg { width: 100%; }
   }
   #abstractimg, #abstractimg text { font: inherit; }
   #abstractimg rect { fill: #424242; }
   #abstractimg text { fill: #ffffff; font-size: 18px }
   #abstractimg .top { word-spacing: 50px; text-anchor: middle; }
   #abstractimg .left, #abstractimg .bottom { word-spacing: 12px; }
   #abstractimg .right { font-size: 25px; }
  </style><body>
  
  <script src=/html/resources/html-dfn.js async=""></script>
  <script data-file-issue-url=https://github.com/whatwg/html/issues/new async="" src=https://resources.whatwg.org/file-issue.js></script>
  <header id=head class="head with-buttons">
   <a href=https://whatwg.org/ class=logo><img alt=WHATWG src=https://resources.whatwg.org/logo.svg width=100 height=100></a>
   <hgroup><h1 class=allcaps>HTML</h1><h2 id=living-standard class="no-num no-toc">Living Standard — Last Updated <span class=pubdate>3 September 2020</span></h2><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/living-standard-mdash-last-updated-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/living-standard-mdash-last-updated-date-01-jan-1901.zh.html?filename=living-standard-mdash-last-updated-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fliving-standard-mdash-last-updated-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/commit-snapshot-mdash-last-updated-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/commit-snapshot-mdash-last-updated-date-01-jan-1901.zh.html?filename=commit-snapshot-mdash-last-updated-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fcommit-snapshot-mdash-last-updated-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div><div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/review-draft-mdash-published-date-01-jan-1901.en.html data-zh-file="https://github.com/whatwg-cn/html/new/master/src/review-draft-mdash-published-date-01-jan-1901.zh.html?filename=review-draft-mdash-published-date-01-jan-1901.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Freview-draft-mdash-published-date-01-jan-1901.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91"></div></hgroup>
   
   
   <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-91053840-1', 'auto');
      ga('send', 'pageview');
   </script>
  </header>

  

  

  
<div data-en-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" class=translate-info data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/table-of-contents.en.html data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/table-of-contents.zh.html></div>
  

  
<div data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/full-table-of-contents.en.html data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/full-table-of-contents.zh.html></div>
  

  

  

  <nav><a href=canvas.html>← 4.12.5 The canvas element</a> — <a href=./>Table of Contents</a> — <a href=semantics-other.html>4.14 Common idioms without dedicated elements →</a></nav><ol class=toc><li id=toc-semantics><ol><li><a href=custom-elements.html#custom-elements><span class=secno>4.13</span> Custom elements</a><ol><li><a href=custom-elements.html#custom-elements-intro><span class=secno>4.13.1</span> 概述</a><ol><li><a href=custom-elements.html#custom-elements-autonomous-example><span class=secno>4.13.1.1</span> 创建自主的 Custom Element</a><li><a href=custom-elements.html#custom-elements-customized-builtin-example><span class=secno>4.13.1.2</span> 创建定制的内建元素</a><li><a href=custom-elements.html#custom-elements-autonomous-drawbacks><span class=secno>4.13.1.3</span> 自主 custom element 的缺点</a><li><a href=custom-elements.html#custom-elements-upgrades-examples><span class=secno>4.13.1.4</span> 在创建之后升级元素</a></ol><li><a href=custom-elements.html#custom-element-conformance><span class=secno>4.13.2</span> 对 custom element 构造器的要求</a><li><a href=custom-elements.html#custom-elements-core-concepts><span class=secno>4.13.3</span> 核心概念</a><li><a href=custom-elements.html#custom-elements-api><span class=secno>4.13.4</span> <code>CustomElementRegistry</code> 接口</a><li><a href=custom-elements.html#升级><span class=secno>4.13.5</span> 升级</a><li><a href=custom-elements.html#custom-element-reactions><span class=secno>4.13.6</span> Custom element reactions</a></ol></ol></ol><h3 id=custom-elements><span class=secno>4.13</span> Custom elements<a href=#custom-elements class=self-link></a></h3><div class="mdn-anno wrapped"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements title="One of the key features of the Web Components standard is the ability to create custom elements that encapsulate your functionality on an HTML page, rather than having to make do with a long, nested batch of elements that together provide a custom page feature. This article introduces the use of the Custom Elements API.">Using_custom_elements</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span><hr><span class=caniuse><span><a href="https://caniuse.com/#feat=custom-elementsv1" title="Custom Elements (V1)">caniuse.com table</a></span></span></div></div></div>
<div data-zh-date="" data-en-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/the-elements-of-html/custom-elements/index.zh.html?filename=index.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fthe-elements-of-html%2Fcustom-elements%2Findex.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/index.en.html></div>

  <h4 id=custom-elements-intro><span class=secno>4.13.1</span> 概述<a href=#custom-elements-intro class=self-link></a></h4>
<div data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/introduction/index.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/introduction/index.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p><a href=#custom-element id=custom-elements-intro:custom-element>Custom elements</a> 为作者提供了一种构建他们自己的完整特性的
  DOM 元素的方式。即使作者们总是可以在他们的文档中使用非标准元素，
  在生效之后使用类似脚本的方式给它们增加应用相关的行为，
  但是这些元素由于历史原因表现并不一致，也不是很好用。
  通过 <a href=#element-definition id=custom-elements-intro:element-definition>定义</a> custom element，
  作者可以告知解析器如何适当地构造一个元素，以及这类元素如何响应变化。</p>

  <p>Custom elements 是 "解释 Web 平台" 努力中的一部分，
  在这一工作中，我们通过将低层的可扩展点（比如定义 Custom Element）暴露给作者，
  来解释既有的平台特性（比如 HTML 的元素）。
  即使现在 Custom Element 在功能和语义上都有很多能力的局限，
  尚不能完整地解释现存 HTML 元素的行为，我们希望随着时间的推移逐渐缩小这个差异。</p>

  <h5 id=custom-elements-autonomous-example><span class=secno>4.13.1.1</span> 创建自主的 Custom Element<a href=#custom-elements-autonomous-example class=self-link></a></h5>
<div data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/introduction/creating-an-autonomous-custom-element.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/introduction/creating-an-autonomous-custom-element.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>为了说明如何创建 <a href=#autonomous-custom-element id=custom-elements-autonomous-example:autonomous-custom-element>autonomous custom element</a>，
  我们定义 Custom Element 来封装一个显示国旗的小图标。
  我们的目标是可以像这样使用它：</p>

  <pre>&lt;flag-icon country="nl">&lt;/flag-icon></pre>

  <p>为了实现这一效果，我们首先为该 Custom Element 声明一个类，扩展
  <code id=custom-elements-autonomous-example:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>：</p>

  <pre>class FlagIcon extends HTMLElement {
  constructor() {
    super();
    this._countryCode = null;
  }

  static get observedAttributes() { return ["country"]; }

  attributeChangedCallback(name, oldValue, newValue) {
    // name will always be "country" due to observedAttributes
    this._countryCode = newValue;
    this._updateRendering();
  }
  connectedCallback() {
    this._updateRendering();
  }

  get country() {
    return this._countryCode;
  }
  set country(v) {
    this.setAttribute("country", v);
  }

  _updateRendering() {
    // Left as an exercise for the reader. But, you'll probably want to
    // check this.ownerDocument.defaultView to see if we've been
    // inserted into a document with a browsing context, and avoid
    // doing any work if not.
  }
}</pre>

  <p>我们现在需要使用这个类来定义这个元素：</p>

  <pre>customElements.define("flag-icon", FlagIcon);</pre>

  <p>此时，上述代码生效了！解析器一旦看到 <code>flag-icon</code> 标签， 就会为我们的 <code>FlagIcon</code>
  类构造一个新的实例，并把新的 <code>country</code> 属性告诉我们的代码，
  接着我们用它来设置内部状态并更新渲染（在适当的时候）。</p>

  <p>你也可以使用 DOM API 创建 <code>flag-icon</code> 元素：</p>

  <pre>const flagIcon = document.createElement("flag-icon")
flagIcon.country = "jp"
document.body.appendChild(flagIcon)</pre>

  <p>最后，我们还可以直接使用 <a href=#custom-element-constructor id=custom-elements-autonomous-example:custom-element-constructor>custom element 构造器</a>。
  这就是说上述代码等效于：</p>

  <pre>const flagIcon = new FlagIcon()
flagIcon.country = "jp"
document.body.appendChild(flagIcon)</pre>

  <h5 id=custom-elements-customized-builtin-example><span class=secno>4.13.1.2</span> 创建定制的内建元素<a href=#custom-elements-customized-builtin-example class=self-link></a></h5>
<div data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/introduction/creating-a-customized-built-in-element.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/introduction/creating-a-customized-built-in-element.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element>定制的内建元素</a> 是一种独特的
  <a href=#custom-element id=custom-elements-customized-builtin-example:custom-element>custom element</a>，它的定义稍有不同，但使用方式与
  <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element>自主的 custom elements</a> 很不一样。
  它们的存在是为了允许通过扩展新的定制功能来复用现存 HTML 元素的行为。
  因为如果只使用 <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-2>自主的 custom elements</a>
  很多 HTML 元素的现存行为可能需要重复实现，
  但使用 <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-2>定制的内建元素</a> 允许给既有的元素
  安装自定义的构造行为、生命周期钩子、以及原型链。
  本质上就是在已经有的元素上 "混入" 这些定制的功能。</p>

  <p><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-3>定制的内建元素</a> 要求一种与
  <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-3>自主的 custom elements</a>
  不同的语法，因为用户代理和其他软件会提取元素的 局部名 来识别元素的语义和行为。
  就是说建立在既有行为基础上的 <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-4>定制的内建元素</a> 的概念
  严重依赖于被扩展的元素保持他们原有的 局部名。</p>

  <p>在这个例子中，我们将会创建一个名为 <code>plastic-button</code> 的
  <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-5>定制的内建元素</a>。它像一个普通按钮一样，但是当点击时有漂亮的动画效果。
  就像以前一样，我们从定义一个类开始，虽然这次我们扩展的是 <code id=custom-elements-customized-builtin-example:htmlbuttonelement><a href=form-elements.html#htmlbuttonelement>HTMLButtonElement</a></code>
  而不是 <code id=custom-elements-customized-builtin-example:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>：</p>

  <pre>class PlasticButton extends HTMLButtonElement {
  constructor() {
    super();

    this.addEventListener("click", () => {
      // Draw some fancy animation effects!
    });
  }
}</pre>

  <p>在定义我们的 custom element 时，我们必须同时声明 <code>extends</code>
  选项：</p>

  <pre>customElements.define("plastic-button", PlasticButton, { extends: "button" });</pre>

  <p>通常被扩展元素的名字不能简单地通过看它扩展了什么元素接口来确定，
  因为很多元素共用同样的接口（比如 <code id=custom-elements-customized-builtin-example:the-q-element><a href=text-level-semantics.html#the-q-element>q</a></code> 和 <code id=custom-elements-customized-builtin-example:the-blockquote-element><a href=grouping-content.html#the-blockquote-element>blockquote</a></code>
  共用 <code id=custom-elements-customized-builtin-example:htmlquoteelement><a href=grouping-content.html#htmlquoteelement>HTMLQuoteElement</a></code>）。</p>

  <p>为了使用我们的 <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-6>定制内建元素</a>，
  我们使用 <code id=custom-elements-customized-builtin-example:the-button-element><a href=form-elements.html#the-button-element>button</a></code> 元素上的 <code id=custom-elements-customized-builtin-example:attr-is><a href=#attr-is>is</a></code> 属性：</p>

  <pre>&lt;button is="plastic-button">Click Me!&lt;/button></pre>

  <p>尝试将 <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-7>定制的内建元素</a> 当做
  <a href=#autonomous-custom-element id=custom-elements-customized-builtin-example:autonomous-custom-element-4>自主 custom element</a> 使用 <em>不会</em> 奏效；
  也就是说 <code>&lt;plastic-button>Click me?&lt;/plastic-button></code>
  只会创建一个没有特殊行为的 <code id=custom-elements-customized-builtin-example:htmlelement-2><a href=dom.html#htmlelement>HTMLElement</a></code>。</p>

  <p>如果你需要编程方式创建一个类型扩展的元素，可以使用下面的形式
  <code id=custom-elements-customized-builtin-example:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://dom.spec.whatwg.org/#dom-document-createelement>createElement()</a></code>：</p>

  <pre>const plasticButton = document.createElement("button", { is: "plastic-button" });
plasticButton.textContent = "Click me!";</pre>

  <p>像以前一样，构造器也好使：</p>

  <pre>const plasticButton2 = new PlasticButton();
console.log(plasticButton2.localName);          // 将会输出 "button"
console.log(plasticButton2.getAttribute("is")); // 将会输出 "plastic-button"</pre>

  <p>值得一提的是，所有 <code id=custom-elements-customized-builtin-example:the-button-element-2><a href=form-elements.html#the-button-element>button</a></code> 的特殊行为也适用于该 "plastic buttons"：
  获得焦点行为、参与 <a href=form-control-infrastructure.html#concept-form-submit id=custom-elements-customized-builtin-example:concept-form-submit>表单提交</a> 的能力、
  <code id=custom-elements-customized-builtin-example:attr-fe-disabled><a href=form-control-infrastructure.html#attr-fe-disabled>disabled</a></code> 属性，等等。</p>

  <p id=customized-built-in-element-restrictions><a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-8>定制的内建元素</a> 设计为允许扩展既有 HTML 元素，尤其是那些用户代理提供了
  有用行为或者 API 的元素。它们只能扩展在本标准中定义的现存 HTML 元素，不可继承遗留元素，
  比如 <code id=custom-elements-customized-builtin-example:bgsound><a href=obsolete.html#bgsound>bgsound</a></code>， <code id=custom-elements-customized-builtin-example:blink><a href=obsolete.html#blink>blink</a></code>， <code id=custom-elements-customized-builtin-example:isindex><a href=obsolete.html#isindex>isindex</a></code>， <code id=custom-elements-customized-builtin-example:keygen><a href=obsolete.html#keygen>keygen</a></code>，
  <code id=custom-elements-customized-builtin-example:multicol><a href=obsolete.html#multicol>multicol</a></code>， <code id=custom-elements-customized-builtin-example:nextid><a href=obsolete.html#nextid>nextid</a></code>， 或者
  使用 <code id=custom-elements-customized-builtin-example:htmlunknownelement><a href=dom.html#htmlunknownelement>HTMLUnknownElement</a></code> 作为它们的 <a href=https://dom.spec.whatwg.org/#concept-element-interface id=custom-elements-customized-builtin-example:element-interface data-x-internal=element-interface>元素接口</a>
  来定义的 <code id=custom-elements-customized-builtin-example:spacer><a href=obsolete.html#spacer>spacer</a></code>。</p>

  <p>这一要求的一个原因是向后兼容性：如果定义了一个
  <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-9>定制内建元素</a>，扩展了
  一个目前未知的元素，比如 <code>combobox</code>，这将会阻止本标准在将来定义一个
  <code>combobox</code> 元素，因为派生过
  <a href=#customized-built-in-element id=custom-elements-customized-builtin-example:customized-built-in-element-10>定制内建元素</a> 的客户可能依赖于它们的基元素
  没有那些有趣的用户代理提供的行为。</p>

  <p>此外， <code id=custom-elements-customized-builtin-example:applet><a href=obsolete.html#applet>applet</a></code> 元素不可被扩展，因为它们正在被 Web 平台移除的过程中。</p>

  <h5 id=custom-elements-autonomous-drawbacks><span class=secno>4.13.1.3</span> 自主 custom element 的缺点<a href=#custom-elements-autonomous-drawbacks class=self-link></a></h5>
<div data-zh-date="Sat Mar 10 2018 18:22:55 GMT+0000 (UTC)" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/introduction/drawbacks-of-autonomous-custom-elements.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/introduction/drawbacks-of-autonomous-custom-elements.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>正如下文规定，以及上文提到的，简单地定义和使用一个称为
  <code>taco-button</code> 不意味着这个元素代表 <a href=dom.html#represents id=custom-elements-autonomous-drawbacks:represents>represent</a> 按钮。也就是说像 Web 浏览器、搜索引擎、
  或可访问性技术这些工具将不会自动仅仅基于它定义的名字，就把它当做一个按钮。</p>

  <p>为了向不同的用户表达期望的按钮语义，在使用
  <a href=#autonomous-custom-element id=custom-elements-autonomous-drawbacks:autonomous-custom-element>自主 custom element</a> 的时候，
  就有必要应用下面这些技术了：</p>

  <ul><li><p>添加 <code id=custom-elements-autonomous-drawbacks:attr-tabindex><a href=interaction.html#attr-tabindex>tabindex</a></code> 属性将会让
   <code>taco-button</code> 变成 <a href=dom.html#interactive-content id=custom-elements-autonomous-drawbacks:interactive-content>交互内容</a>，
   因此可以成为 <a href=interaction.html#focusable-area id=custom-elements-autonomous-drawbacks:focusable-area>可聚焦区域</a>。
   注意如果 <code>taco-button</code> 如果逻辑上被 disabled，
   <code id=custom-elements-autonomous-drawbacks:attr-tabindex-2><a href=interaction.html#attr-tabindex>tabindex</a></code> 属性就需要被移除。<li><p>添加各种 ARIA 属性帮助我们向可访问性技术表达语义。比如，
   设置 <code id=custom-elements-autonomous-drawbacks:attr-aria-role><a href=infrastructure.html#attr-aria-role>role</a></code> 属性为
   "<code id=custom-elements-autonomous-drawbacks:attr-aria-role-button><a data-x-internal=attr-aria-role-button href=https://w3c.github.io/aria/aria/aria.html#button>button</a></code>" 表示这是一个按钮，
   使得用户可以在他们的可访问性技术中使用像按钮一样的工具，成功地与这一控件进行交互。
   设置 <code id=custom-elements-autonomous-drawbacks:attr-aria-label><a data-x-internal=attr-aria-label href=https://w3c.github.io/aria/aria/aria.html#aria-label>aria-label</a></code> 属性很有必要，
   这会给按钮一个 <a href=https://w3c.github.io/aria/aria/aria.html#dfn-accessible-name id=custom-elements-autonomous-drawbacks:concept-accessible-name data-x-internal=concept-accessible-name>可访问的名字</a>，
   而不是让可访问性技术遍历它的子文本节点并声明。
   当按钮逻辑上被 disabled 时，
   设置 <code id=custom-elements-autonomous-drawbacks:attr-aria-disabled><a data-x-internal=attr-aria-disabled href=https://w3c.github.io/aria/aria/aria.html#aria-disabled>aria-disabled</a></code> 属性为 "<code>true</code>"
   向可访问性技术表示该按钮被禁用的状态。<li><p>添加按钮常见的事件处理器来帮助向 Web 浏览器用户表达按钮的语义。
   在这一情形下，最相关的事件处理器当数代理合适的
   <code id=custom-elements-autonomous-drawbacks:event-keydown><a data-x-internal=event-keydown href=https://w3c.github.io/uievents/#event-type-keydown>keydown</a></code> 事件并把它变成
   <code id=custom-elements-autonomous-drawbacks:event-click><a data-x-internal=event-click href=https://w3c.github.io/uievents/#event-type-click>click</a></code> 事件，这样你既可以用键盘也可以用鼠标来激活该按钮。<li><p>除了 <code>taco-button</code> 元素的默认视觉样式之外，
   其视觉样式也将需要更新来反映其逻辑状态的变化，比如被禁用；
   这就是说任何包含 <code>taco-button</code> 规则的样式表都将需要
   包含 <code>taco-button[disabled]</code> 规则。</ul>

  <p>考虑到这些点，一个全特性的 <code>taco-button</code> 想要负责表达按钮的语义
  （包括被禁用的能力），看起来可能是这样的：</p>

  <pre>class TacoButton extends HTMLElement {
  static get observedAttributes() { return ["disabled"]; }

  constructor() {
    super();

    this.addEventListener("keydown", e => {
      if (e.keyCode === 32 || e.keyCode === 13) {
        this.dispatchEvent(new MouseEvent("click", {
          bubbles: true,
          cancelable: true
        }));
      }
    });

    this.addEventListener("click", e => {
      if (this.disabled) {
        e.preventDefault();
        e.stopPropagation();
      }
    });

    this._observer = new MutationObserver(() => {
      this.setAttribute("aria-label", this.textContent);
    });
  }

  connectedCallback() {
    this.setAttribute("role", "button");
    this.setAttribute("tabindex", "0");

    this._observer.observe(this, {
      childList: true,
      characterData: true,
      subtree: true
    });
  }

  disconnectedCallback() {
    this._observer.disconnect();
  }

  get disabled() {
    return this.hasAttribute("disabled");
  }

  set disabled(v) {
    if (v) {
      this.setAttribute("disabled", "");
    } else {
      this.removeAttribute("disabled");
    }
  }

  attributeChangedCallback() {
    // only is called for the disabled attribute due to observedAttributes
    if (this.disabled) {
      this.removeAttribute("tabindex");
      this.setAttribute("aria-disabled", "true");
    } else {
      this.setAttribute("tabindex", "0");
      this.setAttribute("aria-disabled", "false");
    }
  }
}</pre>

  <p>即使有这样复杂的元素定义，该元素对用户来讲并不好用：它不断地根据自己的意愿添加
  <code id=custom-elements-autonomous-drawbacks:attr-tabindex-3><a href=interaction.html#attr-tabindex>tabindex</a></code> 和 <code id=custom-elements-autonomous-drawbacks:attr-aria-*><a href=infrastructure.html#attr-aria-*>aria-*</a></code> 属性。
  这是因为现在还没有办法设置 Custom Element 的默认的可访问性语义或者获得焦点行为。
  只能强制使用这些属性来完成这一工作（即使它们通常是保留的，只供用户来重写默认行为）。</p>

  <p>相比而言，一个简单的 <a href=#customized-built-in-element id=custom-elements-autonomous-drawbacks:customized-built-in-element>定制内建元素</a>，
  如上一节所述，将会自动继承 <code id=custom-elements-autonomous-drawbacks:the-button-element><a href=form-elements.html#the-button-element>button</a></code> 的语义和行为，不需手动实现这些行为。
  通常对于任何有着建立在既有 HTML 元素之上的明显语义和行为的元素，
  <a href=#customized-built-in-element id=custom-elements-autonomous-drawbacks:customized-built-in-element-2>定制内建元素</a> 更容易开发、维护，以及使用。</p>

  <h5 id=custom-elements-upgrades-examples><span class=secno>4.13.1.4</span> 在创建之后升级元素<a href=#custom-elements-upgrades-examples class=self-link></a></h5>
<div data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/introduction/upgrading-elements-after-their-creation.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/introduction/upgrading-elements-after-their-creation.en.html></div>

  <p><i>This section is non-normative.</i></p>

  <p>因为 <a href=#element-definition id=custom-elements-upgrades-examples:element-definition>元素定义</a> 任何时候都可以发生，
  可能会先 <a href=https://dom.spec.whatwg.org/#concept-create-element id=custom-elements-upgrades-examples:create-an-element data-x-internal=create-an-element>创建</a> 一个非 custom element，
  在适当的 <a href=#custom-element-definition id=custom-elements-upgrades-examples:custom-element-definition>定义</a> 注册之后，
  才变成一个 <a href=#custom-element id=custom-elements-upgrades-examples:custom-element>custom element</a>。
  我们称这一过程为 "升级" 元素：从一个普通元素编程一个 Custom Element。</p>

  <p><a href=#升级 id=custom-elements-upgrades-examples:升级>升级</a> 使得
  <a href=#custom-element-definition id=custom-elements-upgrades-examples:custom-element-definition-2>custom element 定义</a> 可以在
  相关元素初（比如被解析器）始创建之后再行注册。这允许渐进增强 Custom Element 的内容。
  例如在下列 HTML 文档中，<code>img-viewer</code> 的元素定义是异步载入的：</p>

  <pre>&lt;!DOCTYPE html>
&lt;html lang="en">
&lt;title>Image viewer example&lt;/title>

&lt;img-viewer filter="Kelvin">
  &lt;img src="images/tree.jpg" alt="A beautiful tree towering over an empty savannah">
&lt;/img-viewer>

&lt;script src="js/elements/img-viewer.js" async>&lt;/script></pre>

  <p><code>img-viewer</code> 元素的定义是被一个标记了
  <code id=custom-elements-upgrades-examples:attr-script-async><a href=scripting.html#attr-script-async>async</a></code> 属性的 <code id=custom-elements-upgrades-examples:the-script-element><a href=scripting.html#the-script-element>script</a></code> 元素加载的。
  在标记代码中该脚本放置在 <code>&lt;img-viewer></code> 标签之后。
  当脚本正在载入时，<code>img-viewer</code> 元素将会被当做未定义元素，
  类似 <code id=custom-elements-upgrades-examples:the-span-element><a href=text-level-semantics.html#the-span-element>span</a></code>。一旦脚本载入，它将会定义 <code>img-viewer</code> 元素，
  并且页面中既有的 <code>img-viewer</code> 元素将会被升级，
  应用 Custom Element 的定义（大概包括根据 "Kelvin" 字符串应用图像光栅，增强图像的视觉效果）。</p>

  <hr>

  <p>注意 <a href=#升级 id=custom-elements-upgrades-examples:升级-2>升级</a> 只会应用于文档树中的元素。
  （形式化地说是 <a href=https://dom.spec.whatwg.org/#connected id=custom-elements-upgrades-examples:connected data-x-internal=connected>已连接的</a> 元素）。没有插入到文档中的元素将会保持未升级的状态。下面的例子说明了这一点：</p>

  <pre>&lt;!DOCTYPE html>
&lt;html lang="en">
&lt;title>Upgrade edge-cases example&lt;/title>

&lt;example-element>&lt;/example-element>

&lt;script>
  "use strict";

  const inDocument = document.querySelector("example-element");
  const outOfDocument = document.createElement("example-element");

  // Before the element definition, both are HTMLElement:
  console.assert(inDocument instanceof HTMLElement);
  console.assert(outOfDocument instanceof HTMLElement);

  class ExampleElement extends HTMLElement {}
  customElements.define("example-element", ExampleElement);

  // After element definition, the in-document element was upgraded:
  console.assert(inDocument instanceof ExampleElement);
  console.assert(!(outOfDocument instanceof ExampleElement));

  document.body.appendChild(outOfDocument);

  // Now that we've moved the element into the document, it too was upgraded:
  console.assert(outOfDocument instanceof ExampleElement);
&lt;/script></pre>

  <h4 id=custom-element-conformance><span class=secno>4.13.2</span> 对 custom element 构造器的要求<a href=#custom-element-conformance class=self-link></a></h4>
<div data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/requirements-for-custom-element-constructors.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/requirements-for-custom-element-constructors.en.html></div>

  <p>当写作 <a href=#custom-element-constructor id=custom-element-conformance:custom-element-constructor>custom element 构造器</a> 时，
  作者应满足下列一致性要求：</p>

  <ul><li><p>构造器体中第一条声明必须是无参数的 <code>super()</code> 调用，
   以此在后续代码执行之前建立正确的原型链以及 <b>this</b>。<li><p>构造器体中禁止出现 <code>return</code> 声明，除非是一个简单的早返回
   （<code>return</code> 或者 <code>return this</code>）。<li><p>构造器禁止使用 <code id=custom-element-conformance:dom-document-write><a href=dynamic-markup-insertion.html#dom-document-write>document.write()</a></code>
   或者 <code id=custom-element-conformance:dom-document-open><a href=dynamic-markup-insertion.html#dom-document-open>document.open()</a></code> 方法。<li><p>禁止检查该元素的属性和子节点，因为在非 <a href=#升级 id=custom-element-conformance:升级>upgrade</a>
   的情形下什么都不会有，但如果依赖于升级会降低该元素的可用性。<li><p>该元素禁止获取任何属性或子节点，这不符合使用
   <code id=custom-element-conformance:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://dom.spec.whatwg.org/#dom-document-createelement>createElement</a></code> 或 <code id=custom-element-conformance:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://dom.spec.whatwg.org/#dom-document-createelementns>createElementNS</a></code> 方法的用户的预期。<li><p>通常，应尽可能将工作推迟到 <code>connectedCallback</code>
   尤其是涉及获取资源和渲染。然而，注意到 <code>connectedCallback</code>
   可能被调用多次，所以你可能需要一个守卫变量，来防止一次性的任何初始化工作被运行多次。<li><p>通常，构造器应该用于设置初始状态和默认值，
   以及建立事件监听器，或者一个 <a id=custom-element-conformance:shadow-root href=https://dom.spec.whatwg.org/#concept-shadow-root data-x-internal=shadow-root>shadow root</a>。</ul>

  <p>在 <a href=https://dom.spec.whatwg.org/#concept-create-element id=custom-element-conformance:create-an-element data-x-internal=create-an-element>元素创建过程</a>，上面的部分要求会被直接或间接地检查。
  如果不遵循它们将会导致 Custom Element 无法被解析器或 DOM API 实例化。
  这些要求在构造器发起的 <a id=custom-element-conformance:microtask href=webappapis.html#microtask>microtask</a>  中仍然有效，
  因为在构造后会立即发生一个 <a href=webappapis.html#perform-a-microtask-checkpoint id=custom-element-conformance:perform-a-microtask-checkpoint>microtask 检查点</a>。</p>

  <h4 id=custom-elements-core-concepts><span class=secno>4.13.3</span> 核心概念<a href=#custom-elements-core-concepts class=self-link></a></h4>
<div data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-date="Sun Mar 11 2018 04:56:33 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/core-concepts.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/core-concepts.en.html></div>

  <p><dfn id=custom-element>custom element</dfn> 是 <a href=https://dom.spec.whatwg.org/#concept-element-custom id=custom-elements-core-concepts:concept-element-custom data-x-internal=concept-element-custom>自定义的</a> 元素。
  非形式化地，这意味着它的构造器和原型链由作者而不是用户代理定义。
  作者提供的构造函数称为 <dfn id=custom-element-constructor data-export="">custom element 构造器</dfn>。</p>

  <p>可以定义两种不同的 <a href=#custom-element id=custom-elements-core-concepts:custom-element>custom elements</a>：</p>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/is title="The is global attribute allows you to specify that a standard HTML element should behave like a defined custom built-in element (see Using custom elements for more details).">Global_attributes/is</a><div class=support><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari no"><span>Safari</span><span>No</span></span><span class="chrome yes"><span>Chrome</span><span>67+</span></span><hr><span class="opera yes"><span>Opera</span><span>55+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios no"><span>Safari iOS</span><span>No</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>67+</span></span><span class="webview_android yes"><span>WebView Android</span><span>67+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>48+</span></span></div></div></div><ol><li><p><dfn id=autonomous-custom-element data-export="">自主的 custom element</dfn> 定义时不包含 <code>extends</code> 选项。这类 custom elements 的 局部名 等于它们
   <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name>定义的名称</a>。<li><p><dfn id=customized-built-in-element data-export="">定制内建元素</dfn> 定义时包含 <code>extends</code> 选项。这类 custom elements 的 局部名 等于它们
   在 <code>extends</code> 选项中传入的值，它们的 <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-2>定义的名称</a> 被用于
   <dfn id=attr-is><code>is</code></dfn> 属性的值，因此它必须是一个
   <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name>合法的 custom element 名</a>。</ol>

  <p>在 <a href=#custom-element id=custom-elements-core-concepts:custom-element-2>custom element</a> 被 <a href=https://dom.spec.whatwg.org/#concept-create-element id=custom-elements-core-concepts:create-an-element data-x-internal=create-an-element>创建</a> 后，
  更改 <code id=custom-elements-core-concepts:attr-is><a href=#attr-is>is</a></code> 属性的值不会更改该元素的行为，因为它只是
  保存为该元素的 <a href=https://dom.spec.whatwg.org/#concept-element-is-value id=custom-elements-core-concepts:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code> 的值</a>。</p>

  <p><a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element>自主的 custom elements</a> 有下列的元素定义：</p>

  <dl class=element><dt><a href=dom.html#concept-element-categories id=custom-elements-core-concepts:concept-element-categories>类别</a>：<dd><a id=custom-elements-core-concepts:flow-content href=dom.html#flow-content>Flow content</a>。<dd><a id=custom-elements-core-concepts:phrasing-content href=dom.html#phrasing-content>Phrasing content</a>。<dd><a id=custom-elements-core-concepts:palpable-content-2 href=dom.html#palpable-content-2>Palpable content</a>。<dt><a href=dom.html#concept-element-contexts id=custom-elements-core-concepts:concept-element-contexts>该元素可使用的上下文</a>：<dd>应该出现 <a id=custom-elements-core-concepts:phrasing-content-2 href=dom.html#phrasing-content>phrasing content</a> 的地方。<dt><a href=dom.html#concept-element-content-model id=custom-elements-core-concepts:concept-element-content-model>内容模型</a>：<dd><a id=custom-elements-core-concepts:transparent href=dom.html#transparent>Transparent</a>。<dt><a href=dom.html#concept-element-attributes id=custom-elements-core-concepts:concept-element-attributes>内容属性</a>：<dd>除 <code id=custom-elements-core-concepts:attr-is-2><a href=#attr-is>is</a></code> 之外的 <a href=dom.html#全局属性 id=custom-elements-core-concepts:全局属性>全局属性</a>。 — Creates a <a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element>customized built-in element</a><dd>任何其他没有命名空间的属性。<dt><a href=dom.html#concept-element-dom id=custom-elements-core-concepts:concept-element-dom>DOM 接口</a>：<dd>由元素作者提供（继承自 <code id=custom-elements-core-concepts:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>）</dl>


  <p><a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-2>自主的 custom element</a> 没有任何特殊含义：它
  <a href=dom.html#represents id=custom-elements-core-concepts:represents>表示</a> 它的子节点。 <a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element-2>定制内建元素</a> 继承了它扩展的元素的语义。</p>

  <p>任何没有命名空间的并与元素功能相关的属性，都可以按照元素作者的决定添加到
  <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-3>自主的 custom element</a> 上，
  只要该属性名是 <a href=infrastructure.html#xml-compatible id=custom-elements-core-concepts:xml-compatible>XML 兼容的</a> 其不含 <a href=https://infra.spec.whatwg.org/#ascii-upper-alpha id=custom-elements-core-concepts:uppercase-ascii-letters data-x-internal=uppercase-ascii-letters>ASCII 大写字母</a>。<code id=custom-elements-core-concepts:attr-is-3><a href=#attr-is>is</a></code> 属性较为特殊，
  它不能声明在 <a href=#autonomous-custom-element id=custom-elements-core-concepts:autonomous-custom-element-4>自主的 custom element</a> 上（如果设置的话不会有任何效果）。</p>

  <p><a href=#customized-built-in-element id=custom-elements-core-concepts:customized-built-in-element-3>定制内建元素</a> 遵循普通的属性名要求
  （基于它们扩展的元素）。新增自定义的基于属性的行为，可使用
  <code id=custom-elements-core-concepts:attr-data-*><a href=dom.html#attr-data-*>data-*</a></code> 属性。</p>

  <hr>

  <p><dfn id=valid-custom-element-name data-export="">合法的 custom element 名</dfn> <var>name</var> 是一个满足下列所有要求的字符序列：</p>

  <ul><li>
    <p><var>name</var> 必须匹配 <code id=custom-elements-core-concepts:prod-potentialcustomelementname><a href=#prod-potentialcustomelementname>PotentialCustomElementName</a></code> 生成式：</p>

    <dl><dt><code><dfn id=prod-potentialcustomelementname>PotentialCustomElementName</dfn> ::=</code><dd><code>[a-z] （<a href=#prod-pcenchar id=custom-elements-core-concepts:prod-pcenchar>PCENChar</a>）* '-'
     （<a href=#prod-pcenchar id=custom-elements-core-concepts:prod-pcenchar-2>PCENChar</a>）*</code><dt><code><dfn id=prod-pcenchar>PCENChar</dfn> ::=</code><dd><code>"-" | "." | [0-9] | "_" | [a-z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] |
     [#xF8-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] |
     [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] |
     [#x10000-#xEFFFF]</code></dl>

    <p>这使用了 <cite>XML</cite> 标准中的 <a href=https://www.w3.org/TR/xml/#sec-notation>EBNF 记法</a> 。 <a href=references.html#refsXML>[XML]</a></p>
   <li>
    <p><var>name</var> 不可是下列之一：</p>

    <ul class=brief><li><code>annotation-xml</code><li><code>color-profile</code><li><code>font-face</code><li><code>font-face-src</code><li><code>font-face-uri</code><li><code>font-face-format</code><li><code>font-face-name</code><li><code>missing-glyph</code></ul>

    <p class=note>上述名字列表总结了所有包含横线的元素名，包括
    <cite>SVG</cite> 和 <cite>MathML</cite>
    <a href=infrastructure.html#other-applicable-specifications id=custom-elements-core-concepts:other-applicable-specifications>相关标准</a>。
    <a href=references.html#refsSVG>[SVG]</a> <a href=references.html#refsMATHML>[MATHML]</a></p>
   </ul>

  <div class=note>
   <p>上述要求保证了 <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name-2>合法 custom element 名</a> 的这些目标：</p>

   <ul><li><p>以 <a href=https://infra.spec.whatwg.org/#ascii-lower-alpha id=custom-elements-core-concepts:lowercase-ascii-letters data-x-internal=lowercase-ascii-letters>ASCII 小写字母</a> 起始，确保 HTML 解析器将它们当做标签而不是文本。<li><p>不包含任何 <a href=https://infra.spec.whatwg.org/#ascii-upper-alpha id=custom-elements-core-concepts:uppercase-ascii-letters-2 data-x-internal=uppercase-ascii-letters>ASCII 大写字母</a>，
    确保用户代理总是可以将 HTML 元素当做大小写不敏感的 ASCII 来处理。<li><p>包含一个横线，用于做命名空间来确保向后兼容（因为 HTML、SVG、MathML 中新增的元素 局部名 不会包含横线）。<li><p>总是可以使用 <code id=custom-elements-core-concepts:dom-document-createelement><a data-x-internal=dom-document-createelement href=https://dom.spec.whatwg.org/#dom-document-createelement>createElement()</a></code> 和 <code id=custom-elements-core-concepts:dom-document-createelementns><a data-x-internal=dom-document-createelementns href=https://dom.spec.whatwg.org/#dom-document-createelementns>createElementNS()</a></code> 来创建它们，
    这些 API 有着比解析器更高的限制。</ul>

   <p>除这些限制之外，允许了大量的名字来给像
   <code>&lt;math-α></code> 或 <code>&lt;emotion-😍></code> 这样的用例最大的自由。</p>
  </div>

  <p><dfn id=custom-element-definition>Custom Element 定义</dfn> 描述了一个 <a href=#custom-element id=custom-elements-core-concepts:custom-element-3>custom element</a> 的组成：</p>

  <dl><dt><dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-name data-export="">name</dfn><dd>一个 <a href=#valid-custom-element-name id=custom-elements-core-concepts:valid-custom-element-name-3>合法的 Custom Element 名称</a><dt><dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-local-name data-export="">局部名</dfn><dd>一个 局部名<dt><dfn data-dfn-for="custom element definition" id=concept-custom-element-definition-constructor data-export="">constructor</dfn><dd>一个Web IDL <code id=custom-elements-core-concepts:idl-function><a data-x-internal=idl-function href=https://heycam.github.io/webidl/#common-Function>Function</a></code> 回调函数类型的值，包装了
   <a href=#custom-element-constructor id=custom-elements-core-concepts:custom-element-constructor>custom element 构造器</a><dt><dfn id=concept-custom-element-definition-observed-attributes>被观察的属性</dfn>列表<dd>一个 <code>sequence&lt;DOMString></code><dt><dfn id=concept-custom-element-definition-lifecycle-callbacks>生命周期回调</dfn>列表<dd>一个映射，其四个键是字符串 "<code>connectedCallback</code>"，
   "<code>disconnectedCallback</code>"， "<code>adoptedCallback</code>"，和
   "<code>attributeChangedCallback</code>"。相应的值是 Web IDL
   <code id=custom-elements-core-concepts:idl-function-2><a data-x-internal=idl-function href=https://heycam.github.io/webidl/#common-Function>Function</a></code> 回调函数类型的值，或者 null。默认每一项的值都是null。<dt>一个<dfn id=concept-custom-element-definition-construction-stack>construction
   stack</dfn><dd>一个初始为空的列表，由 <a href=#concept-upgrade-an-element id=custom-elements-core-concepts:concept-upgrade-an-element>元素升级</a> 算法和
   和 <a href=dom.html#html-element-constructors>HTML 元素构造器</a> 操作。列表中每一项都将是一个元素或者一个
   <dfn id=concept-already-constructed-marker><i>已经构造的</i> 标记</dfn>。</dl>

  <p>给定一个 <var>document</var>，<var>namespace</var>，<var>localName</var>，以及 <var>is</var>，
  <dfn id=look-up-a-custom-element-definition data-export="">查找一个 custom element 的定义</dfn> 应执行下列步骤（
  返回一个 <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition>custom element 定义</a> 或 null）：</p>

  <ol><li><p>如果 <var>namespace</var> 不是 <a id=custom-elements-core-concepts:html-namespace-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML namespace</a>，返回 null。<li><p>如果 <var>document</var> 没有 <a href=browsers.html#concept-document-bc id=custom-elements-core-concepts:concept-document-bc>浏览环境</a>，返回 null。<li><p>令 <var>registry</var> 为 <var>document</var> 的 <a href=browsers.html#concept-document-bc id=custom-elements-core-concepts:concept-document-bc-2>浏览环境</a> 所在 <code id=custom-elements-core-concepts:window><a href=window-object.html#window>Window</a></code> 的
   <code id=custom-elements-core-concepts:customelementregistry><a href=#customelementregistry>CustomElementRegistry</a></code> 对象。<li><p>如果在 <var>registry</var> 中有一个 <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-2>custom element 定义</a> 的
   <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-3>name</a> 和 <a href=#concept-custom-element-definition-local-name id=custom-elements-core-concepts:concept-custom-element-definition-local-name>局部名</a> 都等于
   <var>localName</var>，返回该 <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-3>custom element 定义</a>。<li><p>如果在 <var>registry</var> 中有一个 <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-4>custom element 定义</a> 的
   <a href=#concept-custom-element-definition-name id=custom-elements-core-concepts:concept-custom-element-definition-name-4>name</a> 等于 <var>is</var> 且
   <a href=#concept-custom-element-definition-local-name id=custom-elements-core-concepts:concept-custom-element-definition-local-name-2>局部名</a> 等于 <var>localName</var>，返回该
   <a href=#custom-element-definition id=custom-elements-core-concepts:custom-element-definition-5>custom element 定义</a>。<li><p>返回 null。</ol>

  <h4 id=custom-elements-api><span class=secno>4.13.4</span> <code id=custom-elements-api:customelementregistry><a href=#customelementregistry>CustomElementRegistry</a></code> 接口<a href=#custom-elements-api class=self-link></a></h4>
<div data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/the-customelementregistry-interface.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/the-customelementregistry-interface.en.html></div>

  <p>每个 <code id=custom-elements-api:window><a href=window-object.html#window>Window</a></code> 对象都关联是一个唯一的
  <code id=custom-elements-api:customelementregistry-2><a href=#customelementregistry>CustomElementRegistry</a></code> 对象实例，当 <code id=custom-elements-api:window-2><a href=window-object.html#window>Window</a></code> 对象创建时分配。</p>

  <p class=note>Custom element registries 与 <code id=custom-elements-api:window-3><a href=window-object.html#window>Window</a></code> 对象而不是 <code id=custom-elements-api:document><a href=dom.html#document>Document</a></code>
  对象关联，因为每个 <a href=#custom-element-constructor id=custom-elements-api:custom-element-constructor>custom element 构造器</a> 继承自 <code id=custom-elements-api:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code> 接口，而每个 <code id=custom-elements-api:window-4><a href=window-object.html#window>Window</a></code> 对象只有一个 <code id=custom-elements-api:htmlelement-2><a href=dom.html#htmlelement>HTMLElement</a></code> 接口。</p>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/customElements title="The customElements read-only property of the Window interface returns a reference to the CustomElementRegistry object, which can be used to register new custom elements and get information about previously registered custom elements.">Window/customElements</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span></div></div></div><p><code id=custom-elements-api:window-5><a href=window-object.html#window>Window</a></code> 接口的 <dfn id=dom-window-customelements><code>customElements</code></dfn>
  属性必须返回该 <code id=custom-elements-api:window-6><a href=window-object.html#window>Window</a></code> 对象的 <code id=custom-elements-api:customelementregistry-3><a href=#customelementregistry>CustomElementRegistry</a></code> 对象。</p>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry title="The CustomElementRegistry interface provides methods for registering custom elements and querying registered elements. To get an instance of it, use the window.customElements property.">CustomElementRegistry</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>54+</span></span><hr><span class="opera yes"><span>Opera</span><span>41+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>54+</span></span><span class="webview_android yes"><span>WebView Android</span><span>54+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>6.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>41+</span></span></div></div></div><pre class=idl>interface <dfn id=customelementregistry>CustomElementRegistry</dfn> {
  [<a href=#cereactions id=custom-elements-api:cereactions>CEReactions</a>] void <a href=#dom-customelementregistry-define id=custom-elements-api:dom-customelementregistry-define>define</a>(DOMString name， Function constructor， optional ElementDefinitionOptions options);
  any <a href=#dom-customelementregistry-get id=custom-elements-api:dom-customelementregistry-get>get</a>(DOMString name);
  Promise&lt;void> <a href=#dom-customelementregistry-whendefined id=custom-elements-api:dom-customelementregistry-whendefined>whenDefined</a>(DOMString name);
};

dictionary <dfn id=elementdefinitionoptions>ElementDefinitionOptions</dfn> {
  DOMString extends;
};</pre>

  <p>每个 <code id=custom-elements-api:customelementregistry-4><a href=#customelementregistry>CustomElementRegistry</a></code> 有一个 <a href=#custom-element-definition id=custom-elements-api:custom-element-definition>custom element 定义</a> 的集合，初始为空。通常本标准中的算法在 registry 中通过
  <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name>name</a>，
  <a href=#concept-custom-element-definition-local-name id=custom-elements-api:concept-custom-element-definition-local-name>局部名</a>，
  或 <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor>constructor</a>
  中的任意一个进行查找。</p>

  <p>每个 <code id=custom-elements-api:customelementregistry-5><a href=#customelementregistry>CustomElementRegistry</a></code> 还有一个
  <dfn id=element-definition-is-running>element 定义正在运行</dfn> 标记，
  用来防止 <a href=#element-definition id=custom-elements-api:element-definition>元素定义</a> 被再次调用。
  初始未设置。</p>

  <p>每个 <code id=custom-elements-api:customelementregistry-6><a href=#customelementregistry>CustomElementRegistry</a></code> 还有一个 <dfn id=when-defined-promise-map>when-defined Promise 映射</dfn>，
  将 <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name>合法的 custom element 名</a> 映射为 Promise。
  用来实现 <code id=custom-elements-api:dom-customelementregistry-whendefined-2><a href=#dom-customelementregistry-whendefined>whenDefined()</a></code> 方法。</p>

  <dl class=domintro><dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements><a href=#dom-window-customelements>customElements</a></code> . <code id=dom-customelementregistry-define-dev><a href=#dom-customelementregistry-define>define</a></code>(<var>name</var>，
   <var>constructor</var>)<dd>定义一个新的 <a href=#custom-element id=custom-elements-api:custom-element>custom element</a>，作为 <a href=#autonomous-custom-element id=custom-elements-api:autonomous-custom-element>autonomous custom element</a>，并将指定的名称映射到指定的构造器。<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-2><a href=#dom-window-customelements>customElements</a></code> . <code id=custom-elements-api:dom-customelementregistry-define-2><a href=#dom-customelementregistry-define>define</a></code>(<var>name</var>， <var>constructor</var>，
   { extends: <var>baseLocalName</var> })<dd>定义一个新的 <a href=#custom-element id=custom-elements-api:custom-element-2>custom element</a>，作为 <a href=#customized-built-in-element id=custom-elements-api:customized-built-in-element>定制内建元素</a>，其 <a href=infrastructure.html#element-type id=custom-elements-api:element-type>元素类型</a> 由 <var>baseLocalName</var> 标识的。
   同时将给定的 name 映射到给定的 constructor。当尝试扩展 <a href=#custom-element id=custom-elements-api:custom-element-3>custom element</a> 或未知元素时，
   将会抛出 <a id=custom-elements-api:notsupportederror href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>。<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-3><a href=#dom-window-customelements>customElements</a></code> . <code id=dom-customelementregistry-get-dev><a href=#dom-customelementregistry-get>get</a></code>(<var>name</var>)<dd>获取定义为 <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-2>name</a> 的
   <a href=#custom-element-constructor id=custom-elements-api:custom-element-constructor-2>custom element 构造器</a> 。如果没有
   <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-2>custom element 定义</a> 拥有给定的 <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-3>name</a> 则返回 undefined。<dt><var>window</var> . <code id=custom-elements-api:dom-window-customelements-4><a href=#dom-window-customelements>customElements</a></code> . <code id=dom-customelementregistry-whendefined-dev><a href=#dom-customelementregistry-whendefined>whenDefined</a></code>(<var>name</var>)<dd>返回一个 promise，当有着给定 name 的 <a href=#custom-element id=custom-elements-api:custom-element-4>custom element</a> 变成已定义时被完成。
   （如果这样的 <a href=#custom-element id=custom-elements-api:custom-element-5>custom element</a> 已经定义，返回的 promise 将会立即完成。）
   如果没有给定 <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-2>合法的 Custom Element 名称</a>
   则返回一个已经以
   <a id=custom-elements-api:syntaxerror href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-2><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> 拒绝的 Promise。</dl>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define title="The define() method of the CustomElementRegistry interface defines a new custom element.">CustomElementRegistry/define</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>66+</span></span><hr><span class="opera yes"><span>Opera</span><span>53+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>66+</span></span><span class="webview_android yes"><span>WebView Android</span><span>66+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div></div><p><dfn id=element-definition>元素定义</dfn> 是向 <code id=custom-elements-api:customelementregistry-7><a href=#customelementregistry>CustomElementRegistry</a></code>
  新增一个 <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-3>custom element 定义</a> 的过程。
  由 <code id=custom-elements-api:dom-customelementregistry-define-3><a href=#dom-customelementregistry-define>define()</a></code> 方法完成。
  <dfn id=dom-customelementregistry-define><code>define(<var>name</var>， <var>constructor</var>，
  <var>options</var>)</code></dfn> 方法被调用时必须运行下列步骤：</p>

  <ol><li><p>如果 <a id=custom-elements-api:isconstructor href=https://tc39.github.io/ecma262/#sec-isconstructor data-x-internal=isconstructor>IsConstructor</a>(<var>constructor</var>) 为 false，抛出一个
   <code id=custom-elements-api:typeerror><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> 并中止这些步骤。<li><p>如果 <var>name</var> 不是一个 <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-3>合法的 custom element 名</a>，则抛出一个
   <a id=custom-elements-api:syntaxerror-2 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-3><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> 并中止这些步骤。<li><p>如果该 <code id=custom-elements-api:customelementregistry-8><a href=#customelementregistry>CustomElementRegistry</a></code> 包含 <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-4>name</a> 值为 <var>name</var> 的项目，
   则抛出一个 <a id=custom-elements-api:notsupportederror-2 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-4><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> 并中止这些步骤。<li><p>如果该 <code id=custom-elements-api:customelementregistry-9><a href=#customelementregistry>CustomElementRegistry</a></code> 包含 <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-2>constructor</a> 值为 <var>constructor</var> 的项目，
   则抛出一个 <a id=custom-elements-api:notsupportederror-3 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-5><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> 并中止这些步骤。<li><p>令 <var>localName</var> 为 <var>name</var>。<li><p>令 <var>extends</var> 为 <var>options</var> 的 <code>extends</code> 成员（没有该成员则为 null）。<li>
    <p>如果 <var>extends</var> 不为 null，则：</p>

    <ol><li><p>如果 <var>extends</var> 是一个 <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-4>合法的 custom element 名</a>，则抛出
     <a id=custom-elements-api:notsupportederror-4 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-6><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>。<li><p>如果 <var>extends</var> 的 <a href=https://dom.spec.whatwg.org/#concept-element-interface id=custom-elements-api:element-interface data-x-internal=element-interface>元素接口</a> 的 <a id=custom-elements-api:html-namespace-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML
     namespace</a> 是 <code id=custom-elements-api:htmlunknownelement><a href=dom.html#htmlunknownelement>HTMLUnknownElement</a></code> （例如，如果 <var>extends</var> 表示的元素定义不在本标准中），则抛出
     <a id=custom-elements-api:notsupportederror-5 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-7><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>。<li><p>设置 <var>localName</var> 为 <var>extends</var>。</ol>
   <li><p>如果该 <code id=custom-elements-api:customelementregistry-10><a href=#customelementregistry>CustomElementRegistry</a></code> 的 <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running>元素定义正在运行</a>
   标记被设置，则抛出一个 <a id=custom-elements-api:notsupportederror-6 href=https://heycam.github.io/webidl/#notsupportederror data-x-internal=notsupportederror>"<code>NotSupportedError</code>"</a> <code id=custom-elements-api:domexception-8><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> 并中止这些步骤。<li><p>设置该 <code id=custom-elements-api:customelementregistry-11><a href=#customelementregistry>CustomElementRegistry</a></code> 的 <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running-2>元素定义正在运行</a>
   标记。<li>
    <p>运行下列子步骤并捕获所有异常：</p>

    <ol><li><p>令 <var>prototype</var> 为 <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get data-x-internal=js-get>Get</a>(<var>constructor</var>，
     "prototype")。重新抛出任何异常。<li><p>如果 <a href=https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values id=custom-elements-api:js-type data-x-internal=js-type>Type</a>(<var>prototype</var>) 不是 Object，则抛出
     <code id=custom-elements-api:typeerror-2><a data-x-internal=typeerror href=https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror>TypeError</a></code> 异常。<li><p>令 <var>lifecycleCallbacks</var> 为生命周期回调映射，并拥有四个键 "<code>connectedCallback</code>"， "<code>disconnectedCallback</code>"， "<code>adoptedCallback</code>"， 和 "<code>attributeChangedCallback</code>"，
     每一项对应的值均为 null。</p>

     <li>
      <p>对 <var>lifecycleCallbacks</var> 四个键中的每一项 <var>callbackName</var>，按照上一步列出的顺序：</p>

      <ol><li><p>令 <var>callbackValue</var> 为 <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get-2 data-x-internal=js-get>Get</a>(<var>prototype</var>，
       <var>callbackName</var>)。重新抛出任何异常。</p>

       <li><p>如果 <var>callbackValue</var> 不是 undefined，则设置 <var>lifecycleCallbacks</var> 中键为
       <var>callbackName</var> 的项目的值为 <var>callbackValue</var> <a href=https://heycam.github.io/webidl/#es-type-mapping id=custom-elements-api:concept-idl-convert data-x-internal=concept-idl-convert>转换</a>  为 Web IDL
       <code id=custom-elements-api:idl-function><a data-x-internal=idl-function href=https://heycam.github.io/webidl/#common-Function>Function</a></code> 回调类型的结果。重新抛出任何转换过程中的异常。</ol>
     <li><p>令 <var>observedAttributes</var> 为一个空的 <code>sequence&lt;DOMString></code>。<li>
      <p>如果 <var>lifecycleCallbacks</var> 中键为 "<code>attributeChangedCallback</code>" 的项目的值不是 null，则：</p>

      <ol><li><p>令 <var>observedAttributesIterable</var> 为 <a href=https://tc39.github.io/ecma262/#sec-get-o-p id=custom-elements-api:js-get-3 data-x-internal=js-get>Get</a>(<var>constructor</var>， "observedAttributes")。 重新抛出任何异常。<li><p>如果 <var>observedAttributesIterable</var> 不是 undefined，则设置
       <var>observedAttributes</var> 为 <var>observedAttributesIterable</var> <a href=https://heycam.github.io/webidl/#es-type-mapping id=custom-elements-api:concept-idl-convert-2 data-x-internal=concept-idl-convert>转换</a> 为
       <code>sequence&lt;DOMString></code> 的结果。重新抛出任何转换过程中的异常。</ol>
    </ol>

    <p>然后执行下列的子步骤，不论上述步骤是否抛出异常：</p>

    <ol><li><p>重置 <code id=custom-elements-api:customelementregistry-12><a href=#customelementregistry>CustomElementRegistry</a></code> 的 <a href=#element-definition-is-running id=custom-elements-api:element-definition-is-running-3>元素定义正在运行</a> 标记。</ol>

    <p>最终，如果第一批子步骤抛出了异常，则重新抛出该异常并终止算法。否则继续。</p>
   <li><p>令 <var>definition</var> 为一个新的 <a href=#custom-element-definition id=custom-elements-api:custom-element-definition-4>custom element 定义</a>，
   其 <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-5>name</a> 为 <var>name</var>，
   其 <a href=#concept-custom-element-definition-local-name id=custom-elements-api:concept-custom-element-definition-local-name-2>局部名</a> 为 <var>localName</var>，
   其 <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-3>constructor</a> 为 <var>constructor</var>，
   其 <a href=#concept-custom-element-definition-observed-attributes id=custom-elements-api:concept-custom-element-definition-observed-attributes>observed attributes</a> 为 <var>observedAttributes</var>，
   其 <a href=#concept-custom-element-definition-lifecycle-callbacks id=custom-elements-api:concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</a> 为 <var>lifecycleCallbacks</var>。<li><p>添加 <var>definition</var> 到该该 <code id=custom-elements-api:customelementregistry-13><a href=#customelementregistry>CustomElementRegistry</a></code>。<li><p>令 <var>document</var> 为该 <code id=custom-elements-api:customelementregistry-14><a href=#customelementregistry>CustomElementRegistry</a></code> 的 <a href=webappapis.html#concept-relevant-global id=custom-elements-api:concept-relevant-global>相关全局对象</a> 的 <a href=window-object.html#concept-document-window id=custom-elements-api:concept-document-window>关联的 <code>Document</code></a>。<li><p>令 <var>upgrade candidates</var> 为
   <var>document</var> 的所有 <a href=https://dom.spec.whatwg.org/#concept-shadow-including-descendant id=custom-elements-api:shadow-including-descendant data-x-internal=shadow-including-descendant>shadow-including 后代</a> 中，
   命名空间为 <a id=custom-elements-api:html-namespace-2-2 href=https://infra.spec.whatwg.org/#html-namespace data-x-internal=html-namespace-2>HTML namespace</a> 且 局部名 为 <var>localName</var> 的元素，
   以 <a href=https://dom.spec.whatwg.org/#concept-shadow-including-tree-order id=custom-elements-api:shadow-including-tree-order data-x-internal=shadow-including-tree-order>shadow-including 树序</a>。
   此外如果 <var>extends</var> 不是 null，则只包括 <a href=https://dom.spec.whatwg.org/#concept-element-is-value id=custom-elements-api:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code>
   的值</a> 等于 <var>name</var> 的元素。<li><p>对 <var>upgrade candidates</var> 中的每一个元素 <var>element</var>，
   <a href=#enqueue-a-custom-element-upgrade-reaction id=custom-elements-api:enqueue-a-custom-element-upgrade-reaction>将一个 Custom Element 升级响应加入队列</a>，并指定 <var>element</var> 和
   <var>definition</var>。<li>
    <p>如果该 <code id=custom-elements-api:customelementregistry-15><a href=#customelementregistry>CustomElementRegistry</a></code> 的 <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map>when-defined Promise 映射</a>
    包含键为 <var>name</var> 的项目：</p>

    <ol><li><p>令 <var>promise</var> 为该项目的值。<li><p>以 undefined 完成 <var>promise</var>。<li><p>从该 <code id=custom-elements-api:customelementregistry-16><a href=#customelementregistry>CustomElementRegistry</a></code> 的 <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map-2>when-defined promise 映射</a>
     中删除键为 <var>name</var> 的项目。</ol>
   </ol>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/get title="The get() method of the CustomElementRegistry interface returns the constructor for a previously-defined custom element.">CustomElementRegistry/get</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>66+</span></span><hr><span class="opera yes"><span>Opera</span><span>53+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>66+</span></span><span class="webview_android yes"><span>WebView Android</span><span>66+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div></div><p><dfn id=dom-customelementregistry-get><code>get(<var>name</var>)</code></dfn> 方法被调用时必须执行这些步骤：</p>

  <ol><li><p>如果该 <code id=custom-elements-api:customelementregistry-17><a href=#customelementregistry>CustomElementRegistry</a></code> 包含 <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-6>name</a> 为 <var>name</var> 条目，则返回该条目的
   <a href=#concept-custom-element-definition-constructor id=custom-elements-api:concept-custom-element-definition-constructor-4>构造器</a>。<li><p>否则返回 undefined。</ol>

  <div class="mdn-anno wrapped before"><button onclick=toggleStatus(this) class=mdn-anno-btn><b title="Support in all current engines." class=all-engines-flag>✔</b><span>MDN</span></button><div class=feature><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/whenDefined title="The whenDefined() method of the CustomElementRegistry interface returns a Promise that resolves when the named element is defined.">CustomElementRegistry/whenDefined</a><p class=all-engines-text>Support in all current engines.<div class=support><span class="firefox yes"><span>Firefox</span><span>63+</span></span><span class="safari yes"><span>Safari</span><span>10.1+</span></span><span class="chrome yes"><span>Chrome</span><span>66+</span></span><hr><span class="opera yes"><span>Opera</span><span>53+</span></span><span class="edge_blink yes"><span>Edge</span><span>79+</span></span><hr><span class="edge no"><span>Edge (Legacy)</span><span>No</span></span><span class="ie no"><span>Internet Explorer</span><span>No</span></span><hr><span class="firefox_android yes"><span>Firefox Android</span><span>63+</span></span><span class="safari_ios yes"><span>Safari iOS</span><span>10.3+</span></span><span class="chrome_android yes"><span>Chrome Android</span><span>66+</span></span><span class="webview_android yes"><span>WebView Android</span><span>66+</span></span><span class="samsunginternet_android yes"><span>Samsung Internet</span><span>9.0+</span></span><span class="opera_android yes"><span>Opera Android</span><span>47+</span></span></div></div></div><p><dfn id=dom-customelementregistry-whendefined><code>whenDefined(<var>name</var>)</code></dfn> 方法被调用时必须执行这些步骤：</p>

  <ol><li><p>如果 <var>name</var> 不是一个 <a href=#valid-custom-element-name id=custom-elements-api:valid-custom-element-name-5>合法的 custom element 名称</a>，则返回一个新的
   promise，以 <a id=custom-elements-api:syntaxerror-3 href=https://heycam.github.io/webidl/#syntaxerror data-x-internal=syntaxerror>"<code>SyntaxError</code>"</a> <code id=custom-elements-api:domexception-9><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code> 拒绝它并中止这些步骤。<li><p>如果该 <code id=custom-elements-api:customelementregistry-18><a href=#customelementregistry>CustomElementRegistry</a></code> 包含一个 <a href=#concept-custom-element-definition-name id=custom-elements-api:concept-custom-element-definition-name-7>name</a> 为 <var>name</var> 的条目，则返回一个新的
   promise，以 undefined 完成并中止这些步骤。<li><p>令 <var>map</var> 为该 <code id=custom-elements-api:customelementregistry-19><a href=#customelementregistry>CustomElementRegistry</a></code> 的 <a href=#when-defined-promise-map id=custom-elements-api:when-defined-promise-map-3>when-defined promise 映射</a>。<li><p>如果 <var>map</var> 不包含键为 <var>name</var> 的条目，在 <var>map</var> 中创建一个条目，
   其键为 <var>name</var>，值为一个新的 promise。<li><p>令 <var>promise</var> 为 <var>map</var> 中键为 <var>name</var> 的条目的值。<li><p>返回 <var>promise</var>。</ol>

  <div class=example>
   <p><code id=custom-elements-api:dom-customelementregistry-whendefined-3><a href=#dom-customelementregistry-whendefined>whenDefined()</a></code> 方法可以用来避免
   在合适的 <a href=#custom-element id=custom-elements-api:custom-element-6>custom elements</a> <a href=https://dom.spec.whatwg.org/#concept-element-defined id=custom-elements-api:concept-element-defined data-x-internal=concept-element-defined>被定义</a> 之前执行操作。
   这个例子中我们将它与 <code id=custom-elements-api:selector-defined><a href=semantics-other.html#selector-defined>:defined</a></code> 伪类结合，
   来隐藏一个动态载入的文章内容，直到我们确定它使用的所有
   <a href=#autonomous-custom-element id=custom-elements-api:autonomous-custom-element-2>自主 Custom Element </a> 已经定义。</p>

   <pre>articleContainer.hidden = true;

fetch(articleURL)
  .then(response => response.text())
  .then(text => {
    articleContainer.innerHTML = text;

    return Promise.all(
      [...articleContainer.querySelectorAll(":not(:defined)")]
        .map(el => customElements.whenDefined(el.localName))
    );
  })
  .then(() => {
    articleContainer.hidden = false;
  });</pre>
  </div>

  <h4 id=升级><span class=secno>4.13.5</span> <dfn>升级</dfn><a href=#升级 class=self-link></a></h4>
<div data-zh-date="Sun Feb 25 2018 16:34:32 GMT+0000 (UTC)" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file=https://github.com/whatwg-cn/html/edit/master/src/the-elements-of-html/custom-elements/upgrades.zh.html data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/upgrades.en.html></div>

  <p>给定输入 <a href=#custom-element-definition id=升级:custom-element-definition>custom element 定义</a> <var>definition</var> 和一个元素 <var>element</var>，<dfn id=concept-upgrade-an-element data-export="">升级元素</dfn> 应运行以下步骤：</p>

  <ol><li>
    <p>如果 <var>element</var> 是 <a href=https://dom.spec.whatwg.org/#concept-element-custom id=升级:concept-element-custom data-x-internal=concept-element-custom>自定义的</a>，中止这些步骤。</p>

    <div class=example>
     <p>这一情况在再次进入该算法时就会发生，比如下面的例子：</p>

     <pre>&lt;!DOCTYPE html>
&lt;x-foo id="a">&lt;/x-foo>
&lt;x-foo id="b">&lt;/x-foo>

&lt;script>
// Defining enqueues upgrade reactions for both "a" and "b"
customElements.define("x-foo"， class extends HTMLElement {
  constructor() {
    super();

    const b = document.querySelector("#b");
    b.remove();

    // While this constructor is running for "a"， "b" is still
    // undefined， and so inserting it into the document will enqueue a
    // second upgrade reaction for "b" in addition to the one enqueued
    // by defining x-foo.
    document.body.appendChild(b);
  }
})
&lt;/script></pre>

     <p>这一步会使得第二次以 "<code>b</code>" 为参数调用
       <a href=#concept-upgrade-an-element id=升级:concept-upgrade-an-element>升级元素</a> 算法时直接早退出。
     </p>
    </div>
   <li><p>如果 <var>element</var> 的 <a href=https://dom.spec.whatwg.org/#concept-element-custom-element-state id=升级:custom-element-state data-x-internal=custom-element-state>custom element 状态</a> 是 <code>failed</code>"，则中止这些步骤。<li><p>对 <var>element</var> 的 <a href=https://dom.spec.whatwg.org/#concept-element-attribute id=升级:attribute-list data-x-internal=attribute-list>属性列表</a> 中每一个 <var>attribute</var>，
   按顺序 <a href=#enqueue-a-custom-element-callback-reaction id=升级:enqueue-a-custom-element-callback-reaction>入队一个 Custom Element 反应</a>
   （元素为 <var>element</var>，回调名为 "<code>attributeChangedCallback</code>"），
   参数列表为 <var>attribute</var> 的 局部名，null，<var>attribute</var>的值，以及 <var>attribute</var> 的命名空间。<li><p>如果 <var>element</var> <a href=https://dom.spec.whatwg.org/#connected id=升级:connected data-x-internal=connected>已连接</a>，
    <a href=#enqueue-a-custom-element-callback-reaction id=升级:enqueue-a-custom-element-callback-reaction-2>入队一个 Custom Element 反应</a>
   （元素为 <var>element</var>，回调名为 "<code>attributeChangedCallback</code>"），参数列表为空。
   <li><p>将 <var>element</var> 添加到 <var>definition</var> 的 <a href=#concept-custom-element-definition-construction-stack id=升级:concept-custom-element-definition-construction-stack>构造栈</a> 尾部。<li><p>令 <var>C</var> 为 <var>definition</var> 的 <a href=#concept-custom-element-definition-constructor id=升级:concept-custom-element-definition-constructor>构造器</a>。<li>
    <p>运行以下子步骤的同时捕获任何异常：</p>

    <ol><li>
      <p>令 <var>constructResult</var> 为无参数 <a href=https://heycam.github.io/webidl/#construct-a-callback-function id=升级:es-constructing-callback-functions data-x-internal=es-constructing-callback-functions>构造</a>
      <var>C</var> 的结果。</p>

      <p class=note>如果 <var>C</var> <a href=#custom-element-conformance>不合规范地</a>
      使用了以 <code id=升级:cereactions><a href=#cereactions>[CEReactions]</a></code> 扩展属性修饰的 API，
      那么就在这一步中，在 <var>C</var> 结束前执行本算法开始时入队的回调，此后将控制返回给本算法。
      否则，在 <var>C</var> 和其他升级过程结束后再执行它们。</p>
     <li>
      <p>如果 <a id=升级:samevalue href=https://tc39.github.io/ecma262/#sec-samevalue data-x-internal=samevalue>SameValue</a>(<var>constructResult</var>， <var>element</var>) 为 false，
      那么抛出一个 <a id=升级:invalidstateerror href=https://heycam.github.io/webidl/#invalidstateerror data-x-internal=invalidstateerror>"<code>InvalidStateError</code>"</a> <code id=升级:domexception><a data-x-internal=domexception href=https://heycam.github.io/webidl/#dfn-DOMException>DOMException</a></code>。</p>

      <p class=note>如果 <var>C</var> 在调用 <code>super()</code> 之前构造了同一个 Custom Element 的另一个实例，
      或者 <var>C</var> 使用了 JavaScript 的 <code>return</code>重写特性并在构造函数中返回一个任意的对象时，
      就会发生这种情况。</p>
     </ol>

    <p>然后执行下列子步骤，无论上述步骤是否抛出了异常：</p>

    <ol><li>
      <p>从 <var>definition</var> 的 <a href=#concept-custom-element-definition-construction-stack id=升级:concept-custom-element-definition-construction-stack-2>构造栈</a> 尾部移除最后一个入口。</p>

      <div class=note>
       <p>假设 <var>C</var> 调用了 <code>super()</code> （如果它 <a href=#custom-element-conformance>符合规范</a> 就会这样做)，并且该调用是成功的，此时 this 就是
       <a href=#concept-already-constructed-marker id=升级:concept-already-constructed-marker><i>已构造</i> 标记</a>，替换了本算法最开始推入的 <var>element</var>。
       （就是 <a href=dom.html#html-element-constructors>HTML 元素构造器</a> 执行了这个替换。)</p>

       <p>如果 <var>C</var> 没有调用 <code>super()</code> （即它不 <a href=#custom-element-conformance>符合规范</a>），或者在 <a href=dom.html#html-element-constructors>HTML 元素构造</a> 中的任何一步抛出了异常，那么这个入口仍然是 <var>element</var>。</p>
      </div>
     </ol>

    <p>最后，如果上述步骤抛出了异常：</p>

    <ol><li><p>设置 <var>element</var> 的 <a href=https://dom.spec.whatwg.org/#concept-element-custom-element-state id=升级:custom-element-state-2 data-x-internal=custom-element-state>custom element 状态</a> 为 "<code>failed</code>"。<li><p>清空 <var>element</var> 的 <a href=#custom-element-reaction-queue id=升级:custom-element-reaction-queue>custom element 反应队列</a>。</p>

     <li><p>重新抛出该异常，终止本算法。</ol>
   <li><p>设置 <var>element</var> 的 <a href=https://dom.spec.whatwg.org/#concept-element-custom-element-state id=升级:custom-element-state-3 data-x-internal=custom-element-state>custom element 状态</a> 为 "<code>custom</code>"。<li><p>设置 <var>element</var> 的 <a href=https://dom.spec.whatwg.org/#concept-element-custom-element-definition id=升级:concept-element-custom-element-definition data-x-internal=concept-element-custom-element-definition>custom
   element 定义</a> 为 <var>definition</var>。</ol>

  <p>给定输入元素 <var>element</var>，<dfn id=concept-try-upgrade data-export="">尝试升级元素</dfn>，
   应执行下列步骤：</p>

  <ol><li><p>令 <var>definition</var> 为给定 <var>element</var> 的 <a href=https://dom.spec.whatwg.org/#concept-node-document id=升级:node-document data-x-internal=node-document>节点文档</a>，
     <var>element</var>的命名空间， <var>element</var>的 局部名，以及 <var>element</var> 的 <a href=https://dom.spec.whatwg.org/#concept-element-is-value id=升级:concept-element-is-value data-x-internal=concept-element-is-value><code>is</code> 值</a>，
     <a href=#look-up-a-custom-element-definition id=升级:look-up-a-custom-element-definition>查找 custom element 定义</a> 的结果。<li><p>如果 <var>definition</var> 不是 null，那么 <a href=#enqueue-a-custom-element-upgrade-reaction id=升级:enqueue-a-custom-element-upgrade-reaction>入队一个 Custom Element 升级反应</a>，
    其元素为 <var>element</var>，定义为 <var>definition</var>。</ol>

  <h4 id=custom-element-reactions><span class=secno>4.13.6</span> Custom element reactions<a href=#custom-element-reactions class=self-link></a></h4>
<div data-zh-date="" data-en-date="Sat Aug 11 2018 08:00:56 GMT+0000 (UTC)" class=translate-info data-zh-file="https://github.com/whatwg-cn/html/new/master/src/the-elements-of-html/custom-elements/custom-element-reactions.zh.html?filename=custom-element-reactions.zh.html&amp;value=%E4%BB%8E%20https%3A%2F%2Fgithub.com%2Fwhatwg-cn%2Fhtml%2Fblob%2Fmaster%2Fsrc%2Fthe-elements-of-html%2Fcustom-elements%2Fcustom-element-reactions.en.html%20%E6%8B%B7%E8%B4%9D%E8%8B%B1%E6%96%87%E6%BA%90%E7%A0%81%E8%87%B3%E6%AD%A4%EF%BC%8C%E5%BC%80%E5%A7%8B%E7%BF%BB%E8%AF%91" data-en-file=https://github.com/whatwg-cn/html/blob/master/src/the-elements-of-html/custom-elements/custom-element-reactions.en.html></div>

  <p>A <a href=#custom-element id=custom-element-reactions:custom-element>custom element</a> possesses the ability to respond to certain occurrences by
  running author code:</p>

  <ul><li><p>When <a href=#升级 id=custom-element-reactions:升级>upgraded</a>, its <a href=#custom-element-constructor id=custom-element-reactions:custom-element-constructor>constructor</a> is run, with no arguments.<li><p>When it <a id=custom-element-reactions:becomes-connected href=infrastructure.html#becomes-connected>becomes connected</a>, its <code>connectedCallback</code> is
   called, with no arguments.<li><p>When it <a id=custom-element-reactions:becomes-disconnected href=infrastructure.html#becomes-disconnected>becomes disconnected</a>, its <code>disconnectedCallback</code>
   is called, with no arguments.<li><p>When it is <a href=https://dom.spec.whatwg.org/#concept-node-adopt id=custom-element-reactions:concept-node-adopt data-x-internal=concept-node-adopt>adopted</a> into a new document, its <code>adoptedCallback</code> is called, given the old document and new document as
   arguments.<li><p>When any of its attributes are <a href=https://dom.spec.whatwg.org/#concept-element-attributes-change id=custom-element-reactions:concept-element-attributes-change data-x-internal=concept-element-attributes-change>changed</a>, <a href=https://dom.spec.whatwg.org/#concept-element-attributes-append id=custom-element-reactions:concept-element-attributes-append data-x-internal=concept-element-attributes-append>appended</a>, <a href=https://dom.spec.whatwg.org/#concept-element-attributes-remove id=custom-element-reactions:concept-element-attributes-remove data-x-internal=concept-element-attributes-remove>removed</a>, or <a href=https://dom.spec.whatwg.org/#concept-element-attributes-replace id=custom-element-reactions:concept-element-attributes-replace data-x-internal=concept-element-attributes-replace>replaced</a>, its <code>attributeChangedCallback</code> is called, given the attribute's local name, old value,
   new value, and namespace as arguments. (An attribute's old or new value is considered to be null
   when the attribute is added or removed, respectively.)</ul>

  <p>We call these reactions collectively <dfn id=concept-custom-element-reaction>custom
  element reactions</dfn>.</p>

  <p>The way in which <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction>custom element reactions</a>
  are invoked is done with special care, to avoid running author code during the middle of delicate
  operations. Effectively, they are delayed until "just before returning to user script". This means
  that for most purposes they appear to execute synchronously, but in the case of complicated
  composite operations (like <a href=https://dom.spec.whatwg.org/#concept-node-clone id=custom-element-reactions:concept-node-clone data-x-internal=concept-node-clone>cloning</a>, or <a href=https://dom.spec.whatwg.org/#concept-range id=custom-element-reactions:concept-range data-x-internal=concept-range>range</a> manipulation), they will instead be delayed until after all
  the relevant user agent processing steps have completed, and then run together as a batch.</p>

  <p>Additionally, the precise ordering of these reactions is managed via a
  somewhat-complicated stack-of-queues system, described below. The intention behind this system is
  to guarantee that <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-2>custom element reactions</a> always are invoked in the
  same order as their triggering actions, at least within the local context of a single <a href=#custom-element id=custom-element-reactions:custom-element-2>custom
  element</a>. (Because <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-3>custom element
  reaction</a> code can perform its own mutations, it is not possible to give a global ordering
  guarantee across multiple elements.)</p>

  

  <hr>

  <p>Each <a id=custom-element-reactions:unit-of-related-similar-origin-browsing-contexts href=browsers.html#unit-of-related-similar-origin-browsing-contexts>unit of related similar-origin browsing contexts</a> has a <dfn id=custom-element-reactions-stack>custom element
  reactions stack</dfn>, which is initially empty. The <dfn id=current-element-queue>current element queue</dfn> is the
  <a href=#element-queue id=custom-element-reactions:element-queue>element queue</a> at the top of the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack>custom element reactions stack</a>. Each
  item in the stack is an <dfn id=element-queue>element queue</dfn>, which is initially empty as well. Each item in
  an <a href=#element-queue id=custom-element-reactions:element-queue-2>element queue</a> is an element. (The elements are not necessarily <a href=https://dom.spec.whatwg.org/#concept-element-custom id=custom-element-reactions:concept-element-custom data-x-internal=concept-element-custom>custom</a> yet, since this queue is used for <a href=#升级 id=custom-element-reactions:升级-2>upgrades</a> as well.)</p>

  <p>Each <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-2>custom element reactions stack</a> has an associated <dfn id=backup-element-queue>backup element
  queue</dfn>, which an initially-empty <a href=#element-queue id=custom-element-reactions:element-queue-3>element queue</a>. Elements are pushed onto the
  <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue>backup element queue</a> during operations that affect the DOM without going through an
  API decorated with <code id=custom-element-reactions:cereactions><a href=#cereactions>[CEReactions]</a></code>, or through the parser's
  <a id=custom-element-reactions:create-an-element-for-the-token href=parsing.html#create-an-element-for-the-token>create an element for the token</a> algorithm. An example of this is a user-initiated
  editing operation which modifies the descendants or attributes of an <a id=custom-element-reactions:editable href=https://w3c.github.io/editing/execCommand.html#editable data-x-internal=editable>editable</a>
  element. To prevent reentrancy when processing the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-2>backup element queue</a>, each
  <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-3>custom element reactions stack</a> also has a <dfn id=processing-the-backup-element-queue>processing the backup element
  queue</dfn> flag, initially unset.</p>

  <p>All elements have an associated <dfn id=custom-element-reaction-queue>custom element reaction queue</dfn>, initially empty. Each
  item in the <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue>custom element reaction queue</a> is of one of two types:</p>

  <ul><li><p>An <dfn id=upgrade-reaction>upgrade reaction</dfn>, which will <a href=#升级 id=custom-element-reactions:升级-3>upgrade</a> the custom element and contains a <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition>custom
   element definition</a>; or<li><p>A <dfn id=callback-reaction>callback reaction</dfn>, which will call a lifecycle callback, and contains a
   callback function as well as a list of arguments.</ul>

  <p>This is all summarized in the following schematic diagram:</p>

  <p><img src=/html/images/custom-element-reactions.svg alt="A custom element reactions stack consists of a stack of element queues. Zooming in on a particular queue, we see that it contains a number of elements (in our example, <x-a>, then <x-b>, then <x-c>). Any particular element in the queue then has a custom element reaction queue. Zooming in on the custom element reaction queue, we see that it contains a variety of queued-up reactions (in our example, upgrade, then attribute changed, then another attribute changed, then connected)." style="width: 80%; max-width: 580px;"></p>

  <p>To <dfn id=enqueue-an-element-on-the-appropriate-element-queue>enqueue an element on the appropriate element queue</dfn>, given an element
  <var>element</var>, run the following steps:</p>

  <ol><li>
    <p>If the <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-4>custom element reactions stack</a> is empty, then:</p>

    <ol><li><p>Add <var>element</var> to the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-3>backup element queue</a>.<li><p>If the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue>processing the backup element queue</a> flag is set, then
     return.<li><p>Set the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue-2>processing the backup element queue</a> flag.<li>
      <p><a id=custom-element-reactions:queue-a-microtask href=webappapis.html#queue-a-microtask>Queue a microtask</a> to perform the following steps:</p>

      <ol><li><p><a href=#invoke-custom-element-reactions id=custom-element-reactions:invoke-custom-element-reactions>Invoke custom element reactions</a> in the <a href=#backup-element-queue id=custom-element-reactions:backup-element-queue-4>backup element
       queue</a>.<li><p>Unset the <a href=#processing-the-backup-element-queue id=custom-element-reactions:processing-the-backup-element-queue-3>processing the backup element queue</a> flag.</ol>
     </ol>
   <li><p>Otherwise, add <var>element</var> to the <a href=#current-element-queue id=custom-element-reactions:current-element-queue>current element queue</a>.</ol>

  <p>To <dfn id=enqueue-a-custom-element-callback-reaction data-export="">enqueue a custom element callback reaction</dfn>, given a <a href=#custom-element id=custom-element-reactions:custom-element-3>custom
  element</a> <var>element</var>, a callback name <var>callbackName</var>, and a list of
  arguments <var>args</var>, run the following steps:</p>

  <ol><li><p>Let <var>definition</var> be <var>element</var>'s <a href=https://dom.spec.whatwg.org/#concept-element-custom-element-definition id=custom-element-reactions:concept-element-custom-element-definition data-x-internal=concept-element-custom-element-definition>custom element definition</a>.</p>

   <li><p>Let <var>callback</var> be the value of the entry in <var>definition</var>'s <a href=#concept-custom-element-definition-lifecycle-callbacks id=custom-element-reactions:concept-custom-element-definition-lifecycle-callbacks>lifecycle callbacks</a> with
   key <var>callbackName</var>.<li><p>If <var>callback</var> is null, then return<li>
    <p>If <var>callbackName</var> is "<code>attributeChangedCallback</code>", then:</p>

    <ol><li><p>Let <var>attributeName</var> be the first element of <var>args</var>.<li><p>If <var>definition</var>'s <a href=#concept-custom-element-definition-observed-attributes id=custom-element-reactions:concept-custom-element-definition-observed-attributes>observed attributes</a> does
     not contain <var>attributeName</var>, then return.</ol>
   <li><p>Add a new <a href=#callback-reaction id=custom-element-reactions:callback-reaction>callback reaction</a> to <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-2>custom element
   reaction queue</a>, with callback function <var>callback</var> and arguments
   <var>args</var>.<li><p><a href=#enqueue-an-element-on-the-appropriate-element-queue id=custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue>Enqueue an element on the appropriate element queue</a> given
   <var>element</var>.</ol>

  <p>To <dfn id=enqueue-a-custom-element-upgrade-reaction data-export="">enqueue a custom element upgrade reaction</dfn>, given an element
  <var>element</var> and <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-2>custom element definition</a> <var>definition</var>, run the
  following steps:</p>

  <ol><li><p>Add a new <a href=#upgrade-reaction id=custom-element-reactions:upgrade-reaction>upgrade reaction</a> to <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-3>custom element
   reaction queue</a>, with <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-3>custom element definition</a>
   <var>definition</var>.<li><p><a href=#enqueue-an-element-on-the-appropriate-element-queue id=custom-element-reactions:enqueue-an-element-on-the-appropriate-element-queue-2>Enqueue an element on the appropriate element queue</a> given
   <var>element</var>.</ol>

  <p>To <dfn id=invoke-custom-element-reactions>invoke custom element reactions</dfn> in an <a href=#element-queue id=custom-element-reactions:element-queue-4>element queue</a>
  <var>queue</var>, run the following steps:</p>

  <ol><li>
    <p>For each <a href=#custom-element id=custom-element-reactions:custom-element-4>custom element</a> <var>element</var> in <var>queue</var>:</p>

    <ol><li><p>Let <var>reactions</var> be <var>element</var>'s <a href=#custom-element-reaction-queue id=custom-element-reactions:custom-element-reaction-queue-4>custom element reaction
     queue</a>.<li>
      <p>Repeat until <var>reactions</var> is empty:</p>

      <ol><li>
        <p>Remove the first element of <var>reactions</var>, and let <var>reaction</var> be that
        element. Switch on <var>reaction</var>'s type:</p>

        <dl class=switch><dt><a href=#upgrade-reaction id=custom-element-reactions:upgrade-reaction-2>upgrade reaction</a><dd><a href=#concept-upgrade-an-element id=custom-element-reactions:concept-upgrade-an-element>Upgrade</a> <var>element</var> using
         <var>reaction</var>'s <a href=#custom-element-definition id=custom-element-reactions:custom-element-definition-4>custom element definition</a>.<dt><a href=#callback-reaction id=custom-element-reactions:callback-reaction-2>callback reaction</a><dd><a href=https://heycam.github.io/webidl/#invoke-a-callback-function id=custom-element-reactions:es-invoking-callback-functions data-x-internal=es-invoking-callback-functions>Invoke</a> <var>reaction</var>'s
         callback function with <var>reaction</var>'s arguments, and with <var>element</var> as the
         <a href=https://heycam.github.io/webidl/#dfn-callback-this-value id=custom-element-reactions:dfn-callback-this-value data-x-internal=dfn-callback-this-value>callback this value</a>.</dl>

        <p>If this throws an exception, catch it, and <a id=custom-element-reactions:report-the-exception href=webappapis.html#report-the-exception>report the exception</a>.</p>
       </ol>
     </ol>
   </ol>

  <hr>

  <p>To ensure <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-4>custom element reactions</a> are
  triggered appropriately, we introduce the <dfn id=cereactions data-dfn-type=extended-attribute data-lt=CEReactions data-export=""><code>[CEReactions]</code></dfn> IDL <a id=custom-element-reactions:extended-attribute href=https://heycam.github.io/webidl/#dfn-extended-attribute data-x-internal=extended-attribute>extended
  attribute</a>. It indicates that the relevant algorithm is to be supplemented with additional
  steps in order to appropriately track and invoke <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-5>custom element reactions</a>.</p>

  <p>The <code id=custom-element-reactions:cereactions-2><a href=#cereactions>[CEReactions]</a></code> extended attribute must take no
  arguments, and must not appear on anything other than an operation, attribute, setter, or deleter.
  Additionally, it must not appear on readonly attributes.</p>

  <p>Operations, attributes, setters, or deleters annotated with the <code id=custom-element-reactions:cereactions-3><a href=#cereactions>[CEReactions]</a></code> extended attribute must run the following steps in place
  of the ones specified in their description:</p>

  <ol><li><p><a href=https://infra.spec.whatwg.org/#stack-push id=custom-element-reactions:stack-push data-x-internal=stack-push>Push</a> a new <a href=#element-queue id=custom-element-reactions:element-queue-5>element queue</a> onto the
   <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-5>custom element reactions stack</a>.<li><p>Run the originally-specified steps for this construct, catching any exceptions. If the
   steps return a value, let <var>value</var> be the returned value. If they throw an exception, let
   <var>exception</var> be the thrown exception.<li><p>Let <var>queue</var> be the result of <a href=https://infra.spec.whatwg.org/#stack-pop id=custom-element-reactions:stack-pop data-x-internal=stack-pop>popping</a> from the
   <a href=#custom-element-reactions-stack id=custom-element-reactions:custom-element-reactions-stack-6>custom element reactions stack</a>.<li><p><a href=#invoke-custom-element-reactions id=custom-element-reactions:invoke-custom-element-reactions-2>Invoke custom element reactions</a> in <var>queue</var>.<li><p>If an exception <var>exception</var> was thrown by the original steps, rethrow
   <var>exception</var>.<li><p>If a value <var>value</var> was returned from the original steps, return
   <var>value</var>.</ol>

  <div class=note>
   <p>The intent behind this extended attribute is somewhat subtle. One way of accomplishing its
   goals would be to say that every operation, attribute, setter, and deleter on the platform
   must have these steps inserted, and to allow implementers to optimize away
   unnecessary cases (where no DOM mutation is possible that could cause <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-6>custom element reactions</a> to occur).</p>

   <p>However, in practice this imprecision could lead to non-interoperable implementations of <a href=#concept-custom-element-reaction id=custom-element-reactions:concept-custom-element-reaction-7>custom element reactions</a>, as some implementations
   might forget to invoke these steps in some cases. Instead, we settled on the approach of
   explicitly annotating all relevant IDL constructs, as a way of ensuring interoperable behavior
   and helping implementations easily pinpoint all cases where these steps are necessary.</p>
  </div>

  <p>Any nonstandard APIs introduced by the user agent that could modify the DOM in such a way as to
  cause <a href=#enqueue-a-custom-element-callback-reaction id=custom-element-reactions:enqueue-a-custom-element-callback-reaction>enqueuing a custom element
  callback reaction</a> or <a href=#enqueue-a-custom-element-upgrade-reaction id=custom-element-reactions:enqueue-a-custom-element-upgrade-reaction>enqueuing a
  custom element upgrade reaction</a>, for example by modifying any attributes or child elements,
  must also be decorated with the <code id=custom-element-reactions:cereactions-4><a href=#cereactions>[CEReactions]</a></code> attribute.</p>

  <div class=note>
   <p>As of the time of this writing, the following nonstandard or not-yet-standardized APIs are
   known to fall into this category:</p>

   <ul><li><p><code id=custom-element-reactions:htmlelement><a href=dom.html#htmlelement>HTMLElement</a></code>'s <code>outerText</code> IDL attribute<li><p><code id=custom-element-reactions:htmlinputelement><a href=input.html#htmlinputelement>HTMLInputElement</a></code>'s <code>webkitdirectory</code> and <code>incremental</code> IDL attributes<li><p><code id=custom-element-reactions:htmllinkelement><a href=semantics.html#htmllinkelement>HTMLLinkElement</a></code>'s <code>disabled</code> and <code>scope</code> IDL attributes<li><p><code id=custom-element-reactions:shadowroot><a data-x-internal=shadowroot href=https://dom.spec.whatwg.org/#interface-shadowroot>ShadowRoot</a></code>'s <code>innerHTML</code> IDL attribute</ul>
  </div>

  


  <nav><a href=canvas.html>← 4.12.5 The canvas element</a> — <a href=./>Table of Contents</a> — <a href=semantics-other.html>4.14 Common idioms without dedicated elements →</a></nav>
<script src=/html/resources/zh-cn.js></script>
